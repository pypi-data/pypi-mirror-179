(self.webpackChunkpaper_admin=self.webpackChunkpaper_admin||[]).push([[9434],{7758:function(){window.addEventListener("keydown",(e=>{if(!e.defaultPrevented&&e.ctrlKey){const t=document.querySelector(".paper-pagination");if(!t)return;switch(e.key){case"Left":case"ArrowLeft":t.querySelector('.page-link[aria-label="Previous"]').click();break;case"Right":case"ArrowRight":t.querySelector('.page-link[aria-label="Next"]').click();break;default:return}e.preventDefault()}}))},423:function(e,t,s){"use strict";s.r(t);var n=s(1474);class a{constructor(e){this._buildTree(e)}_createNode(e){const t=e.dataset;return{pk:parseInt(t.id),parent:parseInt(t.parent),element:e,childs:[]}}_addNode(e){e&&"number"==typeof e.pk&&(this._nodes[e.pk]=e,isNaN(e.parent)&&this._roots.push(e))}_buildTree(e){const t=[];this._nodes={},this._roots=[],e.forEach((e=>{const s=this._createNode(e);for(this._addNode(s);t.length;){const e=t[0];if(s.parent===e.pk)return e.childs.push(s.pk),void t.unshift(s);t.shift()}t.unshift(s)}))}getNode(e){if(!(e in this._nodes))throw new Error(`node ${e} not found`);return this._nodes[e]}getRoots(){return this._roots.map((e=>e.element))}getDescendants(e){return this.getNode(e).childs.reduce(((e,t)=>{const s=this.getNode(t);return s&&(e.push(s.element),e=e.concat(this.getDescendants(t))),e}),[])}}class r{constructor(e,t){if(this.opts=Object.assign({url:null,tree:!1,handler:".handler",disabledClass:"disabled"},t),this.table=e,this.tbody=e.querySelector("tbody"),!this.tbody)throw new Error("table body not found");this.tree=null,this._createSortable()}_createSortable(){return n.ZP.create(this.tbody,{animation:0,draggable:"tr",handle:this.opts.handler,filter:(e,t,s)=>{if(t.classList.contains(this.opts.disabledClass))return!0;const n=t.querySelector(this.opts.handler);return!(!n||!n.classList.contains(this.opts.disabledClass))||void 0},ghostClass:"sortable-ghost",onStart:this._onStart.bind(this),onMove:this._onMove.bind(this),onEnd:this._onEnd.bind(this)})}_onStart(e){const t=this.tbody.querySelectorAll("tr");if(this.opts.tree){this.tree=new a(t);const s=parseInt(e.item.dataset.parent);isNaN(s)||t.forEach((e=>{const t=parseInt(e.dataset.parent);isNaN(t)||t===s||e.classList.add(this.opts.disabledClass)}))}}_onMove(e){return!e.related.classList.contains(this.opts.disabledClass)}_onEnd(e){this.tbody.querySelectorAll("tr").forEach((e=>{e.classList.remove(this.opts.disabledClass)}));const t=this._getMovedRows(e);if(!t.length||1===t.length)return;this._normalizeTable(e,t);const s=this._createOrderMap(e,t),n=this.tbody.querySelectorAll(this.opts.handler);n.forEach((e=>{e.classList.add(this.opts.disabledClass)})),this._sendRequest(s).then((()=>{n.forEach((e=>{e.classList.remove(this.opts.disabledClass)}))}))}_getMovedRows(e){const t=Math.min(e.oldIndex,e.newIndex),s=Math.max(e.oldIndex,e.newIndex),n=this.tbody.querySelectorAll("tr");let a=Array.prototype.slice.call(n,t,s+1);if(this.tree){const t=parseInt(e.item.dataset.id),s=this.tree.getNode(t);a=a.filter((e=>parseInt(e.dataset.parent)===s.parent))}return a}_createOrderMap(e,t){const s=[],n=[];t.forEach((e=>{e.querySelector(this.opts.handler)&&(s.push(parseInt(e.dataset.id)),n.push(parseInt(e.dataset.orderValue)))}));return e.oldIndex<e.newIndex?n.unshift(n.pop()):n.push(n.shift()),s.reduce(((e,t,s)=>{e[t]=n[s];return this.tbody.querySelector(`tr[data-id="${t}"]`).setAttribute("data-order-value",n[s]),e}),{})}_normalizeTable(e,t){if(!this.tree)return;const s=parseInt(e.item.dataset.id),n=this.tree.getNode(s),a=e.item.previousElementSibling,r=e.item.nextElementSibling,o=t.slice();if(a&&r){const e=parseInt(a.dataset.parent)===n.parent,t=parseInt(r.dataset.parent)===parseInt(a.dataset.id);e&&t&&!o.includes(a)&&o.unshift(a)}o.forEach((e=>{const t=parseInt(e.dataset.id),s=this.tree.getDescendants(t);Element.prototype.after.apply(e,s)}))}_sendRequest(e){return fetch(this.opts.url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>{if(!e.ok){const t=new Error(`${e.status} ${e.statusText}`);throw t.response=e,t}}))}}var o=s(4027);const c="action-toggle",l="paper-actions__counter",i="paper-actions__question",d="paper-actions__all",u="paper-actions__clear";function h(e,t){e.forEach((e=>{e&&"TR"===e.tagName&&e.dispatchEvent(new CustomEvent("select",{bubbles:!0,cancelable:!0,detail:{state:t}}))}))}function p(e){const t=e.reduce(((e,t)=>e+(t.checked?1:0)),0);document.querySelectorAll(`.${l}`).forEach((e=>{e.innerHTML=interpolate(ngettext("%(sel)s of %(cnt)s selected","%(sel)s of %(cnt)s selected",t),{sel:t,cnt:e.dataset.actionsIcnt},!0)})),t===e.length?document.querySelectorAll(`.${i}`).forEach((e=>{e.hidden=!1})):m(e)}function f(e){document.querySelectorAll(".paper-actions__select_across input.select-across").forEach((t=>{t.value=Number(e)}))}function m(e){f(!1);document.querySelectorAll(`.${l}`).forEach((e=>{e.hidden=!1}));document.querySelectorAll(`.${d}`).forEach((e=>{e.hidden=!0}));const t=e.reduce(((e,t)=>e+(t.checked?1:0)),0);document.querySelectorAll(`.${i}`).forEach((s=>{s.hidden=t!==e.length}));document.querySelectorAll(`.${u}`).forEach((e=>{e.hidden=!0}))}const g=document.querySelectorAll(".action-select");g.length&&function(e){let t=null;const s=document.getElementById("result_list"),n=document.getElementById(c);n.addEventListener("change",(()=>{const t=e.map((e=>e.closest("tr")));h(t,n.checked),p(e)})),s.addEventListener("select",(t=>{const a=t.target;if("TR"!==a.tagName||a.closest("table")!==s)return;const r=Boolean(t.detail.state);a.querySelector(".action-select").checked=r,a.classList.toggle("selected",r),n.checked=null==e.find((e=>!e.checked))})),s.addEventListener("click",(s=>{const n=s.target,a=n.closest("tr");if(!a)return;const r=n.closest(".action-checkbox .custom-control"),o=a.querySelector(".action-select");if(s.shiftKey&&t){const s=e.indexOf(t),n=e.indexOf(o),a=Math.min(s,n),r=Math.max(s,n),c=e.slice(a,r+1).map((e=>e.closest("tr")));h(c,t.checked)}else(r||s.ctrlKey&&!s.shiftKey)&&(t=o,h([a],!o.checked));p(e)})),s.addEventListener("mousedown",(e=>{const t=e.target;!e.shiftKey||"TD"!==t.tagName&&"TH"!==t.tagName||e.preventDefault()})),document.addEventListener("click",(e=>{const t=e.target;"A"===t.tagName&&t.closest(`.${i}`)&&(e.preventDefault(),f(!0),document.querySelectorAll(`.${l}`).forEach((e=>{e.hidden=!0})),document.querySelectorAll(`.${d}`).forEach((e=>{e.hidden=!1})),document.querySelectorAll(`.${i}`).forEach((e=>{e.hidden=!0})),document.querySelectorAll(`.${u}`).forEach((e=>{e.hidden=!1})))})),document.addEventListener("click",(t=>{const s=t.target;if("A"===s.tagName&&s.closest(`.${u}`)){t.preventDefault(),n.checked=!1;const s=e.map((e=>e.closest("tr")));h(s,!1),m(e),p(e)}})),function(){let e=!1;document.getElementById("changelist-form").addEventListener("change",(t=>{const s=t.target;"INPUT"===s.tagName?s.closest(".action-select")||s.id===c||(e=!0):"SELECT"===s.tagName&&s.closest(".action-action")||(e=!0)})),document.addEventListener("click",(t=>{t.target.closest('[name="index"]')&&e&&(confirm(gettext("You have unsaved changes on individual editable fields. If you run an action, your unsaved changes will be lost."))||t.preventDefault())})),document.addEventListener("click",(t=>{const s=t.target.closest('[name="_save"]'),n=document.querySelectorAll('.actions select[name="action"]'),a=!Array.prototype.every.call(n,(e=>!e.value));if(s&&a){let s;s=e?confirm(gettext("You have selected an action, but you haven't saved your changes to individual fields yet. Please click OK to save. You'll need to re-run the action.")):confirm(gettext("You have selected an action, and you haven't made any changes on individual fields. You're probably looking for the Go button rather than the Save button.")),s||t.preventDefault()}}))}()}(Array.from(g));s(7758);const y=document.querySelector(".paper-search-form"),b=y&&y.querySelector(".form-control");b&&b.addEventListener("focus",(()=>{b.select()}));var _=s(1976),v=s(6410),E=s(5932);class S extends E.Z{constructor(e){super(),this.opts=Object.assign({altInput:!0,locale:this._getLocale(),dateFormat:this._getDateFormat()},e)}_init(e){const t=e.querySelector("[data-range-start]"),s=Object.assign({},this.opts);(0,_.Gn)(t,s);const n=e.querySelector("[data-range-end]"),a=Object.assign({},this.opts);(0,_.Gn)(n,a),e.addEventListener("click",(e=>{const t=e.target.closest("[data-today]");if(t){const e=t.closest(".input-group"),s=e&&e.querySelector("input");s&&s._flatpickr&&s._flatpickr.setDate("today")}}))}_destroy(e){const t=e.querySelector("[data-range-start]");t._flatpickr&&t._flatpickr.destroy();const s=e.querySelector("[data-range-end]");s._flatpickr&&s._flatpickr.destroy()}_getLocale(){for(const e of(0,v.Z)())if(_.Gn.l10ns[e])return e;return"default"}_getDateFormat(){for(const e of(0,v.Z)())if(_.fK[e])return _.fK[e];return"Y-m-d"}}const k=new S;k.bind(".paper-date-range-filter"),k.attach();const q=new o.C({width:"100%",allowClear:!0,containerCssClass:"select2-container--small"});q.bind(".paper-select2-filter select"),q.attach();const w=new o.C({width:"",allowClear:!0,containerCssClass:"select2-container--small"});w.bind(".paper-table .select-field select"),w.attach();const L=new o.C({allowClear:!0,containerCssClass:"select2-container--small",minimumResultsForSearch:1/0});L.bind(".paper-actions__action select"),L.attach();const I=document.getElementById("result_list");I&&I.classList.contains("paper-table--sortable")&&new r(I,{url:I.dataset.orderUrl,tree:I.classList.contains("paper-table--tree"),handler:".paper-table__sort-handler"})}}]);
//# sourceMappingURL=changelist.9bbb7bc880daf61c5d94.js.map