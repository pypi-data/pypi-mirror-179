"use strict";(self.webpackChunkpaper_admin=self.webpackChunkpaper_admin||[]).push([[9010],{3422:function(t,e,o){o.r(e);var r=o(4827),s=o(4027),n=o(2209),i=o(6358),a=o(9127);const m='input[name$="-TOTAL_FORMS"]',d='input[name$="-INITIAL_FORMS"]',l='input[name$="-MIN_NUM_FORMS"]',h='input[name$="-MAX_NUM_FORMS"]';var c=class{constructor(t){this.root=t}get totalForms(){const t=this.root.querySelector(m);return parseInt(t.value.toString())}set totalForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(m).value=e}get initialForms(){const t=this.root.querySelector(d);return parseInt(t.value.toString())}set initialForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(d).value=e}get minForms(){const t=this.root.querySelector(l);return t?parseInt(t.value.toString()):0}set minForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(l).value=e}get maxForms(){const t=this.root.querySelector(h);return t?parseInt(t.value.toString()):1/0}set maxForms(t){const e=parseInt(t);if(isNaN(e)||e<0)throw new Error(`Invalid value: ${t}`);this.root.querySelector(h).value=e}};var u=class{constructor(t){this.root=t,this.management_form=new c(t),this._initAddFormButtons(),this._initDeleteFormButtons(),this._initSortFormButtons(),this.updateFormIndexes()}get prefix(){const t=this.root.dataset.formsetPrefix;if(!t)throw new Error("formset prefix required");return t}get formContainer(){const t=this.root.dataset.formsetFormContainer;if(!t)throw new Error("container selector required");const e=this.root.querySelector(t);if(!e)throw new Error("container not found");return e}get formSelector(){const t=this.root.dataset.formsetFormSelector;if(!t)throw new Error("form selector required");return t}get templateId(){const t=this.root.dataset.formsetFormTemplate;if(!t)throw new Error("form template ID required");return t}get formTemplate(){const t=document.getElementById(this.templateId);if(!t)throw new Error("form template element not found");return t}getForms(){return this.formContainer.querySelectorAll(this.formSelector)}getFormIndex(t){return Array.from(this.getForms()).indexOf(t)}getAddFormButtons(){const t=[];return document.querySelectorAll('[data-formset-toggle="add"]').forEach((e=>{(this.root.id&&e.dataset.formset===this.root.id||this.root.contains(e)&&!e.dataset.formset)&&t.push(e)})),t}getDeleteFormButtons(){let t=[];return this.getForms().forEach((e=>{const o=e.querySelectorAll('[data-formset-toggle="delete"]');o.length&&(t=t.concat(Array.from(o)))})),t}getSortFormButtons(){let t=[];return this.getForms().forEach((e=>{const o=e.querySelectorAll('[data-formset-toggle="up"]');o.length&&(t=t.concat(Array.from(o)));const r=e.querySelectorAll('[data-formset-toggle="down"]');r.length&&(t=t.concat(Array.from(r)))})),t}hasOriginal(t){return t.classList.contains("has_original")}setAddFormButtonState(t,e){t.disabled=!e}setDeleteFormButtonState(t,e){t.disabled=!e}setSortFormButtonState(t,e){t.disabled=!e}_initAddFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="add"]');e&&(this.root.id&&e.dataset.formset===this.root.id||this.root.contains(e)&&!e.dataset.formset)&&this.addForm()}))}_initDeleteFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="delete"]');if(e&&this.root.contains(e)){const t=e.closest(this.formSelector);t&&this.deleteForm(t)}}))}_initSortFormButtons(){document.addEventListener("click",(t=>{const e=t.target.closest('[data-formset-toggle="up"]'),o=t.target.closest('[data-formset-toggle="down"]');if(e&&this.root.contains(e)){const t=e.closest(this.formSelector);t&&this.moveFormUp(t)}else if(o&&this.root.contains(o)){const t=o.closest(this.formSelector);t&&this.moveFormDown(t)}}))}addForm(){if(this.management_form.totalForms>=this.management_form.maxForms)throw new Error("Maximum number of forms is reached");const t=this.formTemplate.content.cloneNode(!0),e=t.children[0];return this.formContainer.appendChild(t),this.management_form.totalForms++,this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState(),e}deleteForm(t){if(this.management_form.totalForms<=this.management_form.minForms)throw new Error("Minimum number of forms is reached");this.management_form.totalForms--,t.remove(),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}moveFormUp(t){const e=this.getFormIndex(t);if(0===e)throw new Error("form is already first");const o=this.getForms()[e-1];t.after(o),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}moveFormDown(t){const e=this.getForms().length,o=this.getFormIndex(t);if(o===e-1)throw new Error("form is already last");const r=this.getForms()[o+1];t.before(r),this.updateFormIndexes(),this.updateFormOrder(),this.updateButtonsState()}updateFormIndexes(t){void 0===t&&(t=null);let e=0;this.getForms().forEach((o=>{o!==t&&this.hasOriginal(o)&&this.setFormIndex(o,e++)})),this.getForms().forEach((o=>{o===t||this.hasOriginal(o)||this.setFormIndex(o,e++)}))}setFormIndex(t,e){this._setElementIndex(t,e),t.querySelectorAll("*").forEach((t=>{this._setElementIndex(t,e)}))}_setElementIndex(t,e){const o=new RegExp("("+this.prefix+"-(\\d+|__prefix__))"),r=this.prefix+"-"+e;t.htmlFor&&(t.htmlFor=t.htmlFor.replace(o,r)),t.id&&(t.id=t.id.replace(o,r)),t.name&&(t.name=t.name.replace(o,r))}updateFormOrder(t){void 0===t&&(t=null);let e=0;this.getForms().forEach((o=>{o!==t&&this.setFormOrder(o,e++)}))}setFormOrder(t,e){}updateButtonsState(){const t=this.management_form.totalForms>=this.management_form.maxForms;this.getAddFormButtons().forEach((e=>{this.setAddFormButtonState(e,!t)}));const e=this.management_form.totalForms<=this.management_form.minForms;this.getDeleteFormButtons().forEach((t=>{this.setDeleteFormButtonState(t,!e)}));const o=this.getForms().length;this.getSortFormButtons().forEach((t=>{const e=t.closest(this.formSelector),r=this.getFormIndex(e),s=t.dataset.formsetToggle;let n=!0;0===r&&"up"===s&&(n=!1),r===o-1&&"down"===s&&(n=!1),this.setSortFormButtonState(t,n)}))}};i.p8.registerPlugin(a.L);var f=class extends u{constructor(t){super(t),this._isTransitioning=!1}get isTabular(){return this.root.classList.contains("paper-formset--tabular")}setAddFormButtonState(t,e){const o=!this._isTransitioning&&e;super.setAddFormButtonState(t,o),t.classList.toggle("disabled",!o)}setDeleteFormButtonState(t,e){const o=!this._isTransitioning&&e;super.setDeleteFormButtonState(t,o),t.classList.toggle("disabled",!o)}setSortFormButtonState(t,e){const o=!this._isTransitioning&&e;super.setSortFormButtonState(t,o),t.classList.toggle("disabled",!o)}addForm(){this._isTransitioning=!0;const t=super.addForm();n.Z.inlines.trigger("add",[t,this.prefix]);const e={onComplete:()=>{this._isTransitioning=!1,this.updateButtonsState(),n.Z.inlines.trigger("added",[t,this.prefix]),$(document).trigger("formset:added",[$(t),this.prefix])}};return this.isTabular?(e.duration=.2,e.opacity=0,e.clearProps="opacity"):(e.duration=.3,e.height=0,e.clearProps="height"),i.p8.from(t,e),t}deleteForm(t){if(this.management_form.totalForms<=this.management_form.minForms)throw new Error("Minimum number of forms is reached");this.management_form.totalForms--,this.setFormIndex(t,this.management_form.totalForms),this.updateFormIndexes(t),this.updateFormOrder(t),n.Z.inlines.trigger("remove",[t,this.prefix]),this._isTransitioning=!0,this.updateButtonsState();const e={onComplete:()=>{t.remove(),this._isTransitioning=!1,this.updateButtonsState(),n.Z.inlines.trigger("removed",[t,this.prefix]),$(document).trigger("formset:removed",[$(t),this.prefix])}};this.isTabular?(e.duration=.2,e.opacity=0):(e.duration=.3,e.height=0),i.p8.to(t,e)}moveFormUp(t){const e=this.getFormIndex(t);if(0===e)throw new Error("the form is first already");const o=this.getForms()[e-1];this._swapForms(o,t,"up")}moveFormDown(t){const e=this.getForms().length,o=this.getFormIndex(t);if(o===e-1)throw new Error("the form is last already");const r=this.getForms()[o+1];this._swapForms(t,r,"down")}_swapForms(t,e,o){const r=t.getBoundingClientRect(),s=e.getBoundingClientRect(),n=window.scrollY;e.after(t),window.scrollTo(0,n);const a=t.getBoundingClientRect(),m=e.getBoundingClientRect();this.updateFormIndexes(),this.updateFormOrder(),this.formContainer.style.transformStyle="preserve-3d","up"===o?(t.style.transform=`translate3d(0, ${r.top-a.top}px, 0)`,e.style.transform=`translate3d(0, ${s.top-m.top}px, 1px)`):(t.style.transform=`translate3d(0, ${r.top-a.top}px, 1px)`,e.style.transform=`translate3d(0, ${s.top-m.top}px, 0)`),this._isTransitioning=!0,this.updateButtonsState();const d={y:0,clearProps:"transform"};this.isTabular?d.duration=.25:d.duration=.5;const l=i.p8.timeline({onComplete:()=>{this._isTransitioning=!1,this.updateButtonsState(),this.formContainer.style.transformStyle=""}}).to(t,d).to(e,d,0);let h,c;"up"===o?(h=n+(m.top-s.top),c=s.top>.5*window.innerHeight&&m.top>.5*window.innerHeight):(h=n+(a.top-r.top),c=r.top<.5*window.innerHeight&&a.top<.5*window.innerHeight),c||l.to(window,{duration:d.duration,scrollTo:{y:Math.max(0,h)}},0)}setFormOrder(t,e){super.setFormOrder(t,e);const o=t.querySelector(".paper-formset__order");o&&(o.value=e)}setFormIndex(t,e){super.setFormIndex(t,e);const o=t.querySelector(".paper-formset__form-caption");o&&(o.innerHTML=o.innerHTML.replace(/#(\d+|__prefix__)/g,"#"+(e+1)));const r=t.querySelector('[data-formset-toggle="delete"]');if(r&&r.dataset.formsetForm){const t=new RegExp("("+this.prefix+"-(\\d+|__prefix__))"),o=this.prefix+"-"+e,s=r.dataset.formsetForm.replace(t,o);r.setAttribute("data-formset-form",s)}}};i.p8.registerPlugin(a.L),document.addEventListener("click",(t=>{t.target.closest(".scroll-top-button")&&i.p8.to(window,{duration:.3,scrollTo:{y:0}})})),window.addEventListener("scroll",(()=>{const t=document.querySelector(".scroll-top-button");t&&t.classList.toggle("show",window.scrollY>=.75*document.documentElement.clientHeight)}));const g=new s.C({width:"",allowClear:!0});g.bind(".select-field select"),g.attach();let p=[];document.querySelectorAll(".paper-formset").forEach((t=>{const e=new f(t);e.updateButtonsState(),p.push(e)}));let F=!1;const w=document.querySelector(".paper-form");w&&w.addEventListener("submit",(t=>{if(!F)return void(F=!0);t.preventDefault();window.confirm(gettext("You have already submitted this form. Are you sure you want to submit it again?"))&&t.target.submit()})),document.addEventListener("submit",(()=>{p.forEach((t=>{let e=0;t.getForms().forEach((o=>{(o.classList.contains("has_original")||r.Z.containsChangedField(o))&&t.setFormOrder(o,e++)}))}))}))}}]);
//# sourceMappingURL=changeform.c744a2d9a78e75d0888b.js.map