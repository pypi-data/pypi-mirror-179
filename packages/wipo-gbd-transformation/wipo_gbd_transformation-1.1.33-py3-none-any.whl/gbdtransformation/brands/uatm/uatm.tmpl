{% from 'navigation.tmpl' import match %}
{% from 'navigation.tmpl' import enumerate %}

brand:
  type: TRADEMARK
  kind: [Individual]
  statusDate: {{ mark.last_update | format_date }}

  gbdStatus: {{ mark | translate_status }}
  officeStatus: {{ mark | translate_status }}

  {% call(data) match('data', mark) %}
  registrationOfficeCode: {{ data.RegistrationOfficeCode | upper }}
  designatedCountries:
    - {{ data.RegistrationOfficeCode | upper }}

  st13: {{ data.ApplicationNumber | st13 }}
  applicationNumber: {{ data.ApplicationNumber }}
  applicationDate: {{ mark.app_date | format_date }}
  registrationNumber:  {{ data.RegistrationNumber }}
  registrationDate:  {{ data.RegistrationDate }}
  expiryDate: {{ data.ExpiryDate }}

  applicationLanguageCode: uk
  secondLanguageCode: en
  markFeature: {{ data.MarkImageDetails.MarkImage.MarkImageCategory.CategoryCodeDetails.CategoryCode.item | guess_mark_feauture }}

  wordMarkSpecification:
    {% call(item, index)  enumerate('WordMarkSpecification.MarkSignificantVerbalElement.item', data) %}
    {% if index == 1 %}
      {% call(key)  match('key', item) %}
      {% if key._name == '#text' %}
        markVerbalElement:
          - text: {{ key.__value | remove_trailing('*', ',')}}
            languageCode: {{ key.__value | guess_language(None, 'uk') }}
      {% endif %}
      {% endcall %}
    {% else %}
      {% call(key)  match('key', item) %}
      {% if key._name == '#text' %}
        markSignificantVerbalElement:
          - text: {{ key.__value | remove_trailing('*', ',')}}
            languageCode: {{ key.__value | remove_trailing('*', ',') | guess_language(None, 'uk') }}
      {% endif %}
      {% endcall %}
    {% endif %}
    {% endcall %}

  markImageDetails:
    {% call(img) match('MarkImageDetails.MarkImage', data) %}
    - name: {{ img.MarkImageFilename }}
      colourIndicator: {{ img.MarkImageColourIndicator | get_true_or_false }}
      colourClaimed:
        {% call(item) match('MarkImageColourClaimedText.item', img) %}
        {% call(key) match('key', item) %}
        {% if key._name == '#text' %}
          - text: {{ key.__value }}
            languageCode: {{ key.__value | guess_language(None, 'uk') }}
        {% endif %}
        {% endcall %}
        {% endcall %}

      {% call(classification) match('MarkImageCategory.CategoryCodeDetails.CategoryCode', img)%}
      classification:
        kind: Vienna
        version: 7
        code:
        {% call(vc) match('item', classification) %}
          - {{ vc }}
        {% endcall %}
      {% endcall %}
    {% endcall %}

  goodsServices:
    {% call(gs) match('GoodsServicesDetails.GoodsServices.ClassDescriptionDetails.ClassDescription.item', data)%}
    - nice: {{ gs.ClassNumber }}
      terms:
        {% call(gsline) match('ClassificationTermDetails.ClassificationTerm.item', gs)%}
        - languageCode: {{ gsline.ClassificationTermText | guess_language(gsline.ClassificationTermLanguageCode, 'uk') }}
          text: {{ gsline.ClassificationTermText | remove_trailing(',') }}
        {% endcall %}
    {% endcall %}

  priorities:
    {% call(priority) match('PriorityDetails.Priority.item', data) %}
      - countryCode: {{ priority.PriorityCountryCode }}
        number: {{ priority.PriorityNumber }}
        date: {{ priority.PriorityDate | convertdate('%d.%m.%Y') }}
    {% endcall %}

  publications:
    {% call(publication) match('PublicationDetails.Publication', data) %}
      - identifier: {{ publication.PublicationIdentifier }}
        date: {{ publication.PublicationDate | convertdate('%d.%m.%Y') }}
    {% endcall %}

  applicants:
    {% call(applicant) match('ApplicantDetails.Applicant.item', data) %}
      {% call(details) match('ApplicantAddressBook.FormattedNameAddress.Name.FreeFormatName', applicant) %}
        - identifier: {{ details.EDRPOU }}
          kind: {{ details.NameKind }}
          fullName:
            - text: {{ details.FreeFormatNameDetails.FreeFormatNameLine }}
              languageCode: {{ details.FreeFormatNameDetails.FreeFormatNameLine | guess_language(None, 'uk') }}
        {% endcall %}
        {% call(address) match('ApplicantAddressBook.FormattedNameAddress.Address', applicant) %}
          fullAddress:
            - text: {{ address.FreeFormatAddress.FreeFormatAddressLine | remove_trailing('*') }}
              languageCode: {{ address.FreeFormatAddress.FreeFormatAddressLine | guess_language(None, 'uk') }}
          countryCode: {{ address.AddressCountryCode }}
        {% endcall %}
      {% endcall %}

  representatives:
    {% call(representative) match('RepresentativeDetails.Representative.item', data) %}
      {% call(details) match('RepresentativeAddressBook.FormattedNameAddress.Name.FreeFormatName', representative) %}
        - identifier: {{ details.EDRPOU }}
          fullName:
            - text: {{ details.FreeFormatNameDetails.FreeFormatNameDetails.FreeFormatNameLine }}
              languageCode: {{ details.FreeFormatNameDetails.FreeFormatNameDetails.FreeFormatNameLine | guess_language(None, 'uk') }}
        {% endcall %}
        {% call(address) match('RepresentativeAddressBook.FormattedNameAddress.Address', representative) %}
          fullAddress:
            - text: {{ address.FreeFormatAddress.FreeFormatAddressLine | remove_trailing('*') }}
              languageCode: {{ address.FreeFormatAddress.FreeFormatAddressLine | guess_language(None, 'uk') }}
          countryCode: {{ address.AddressCountryCode }}
        {% endcall %}
      {% endcall %}

  {% call(correspondence) match('CorrespondenceAddress.CorrespondenceAddressBook', data) %}
  correspondence:
      fullName:
        - text: {{ correspondence.Name.FreeFormatNameLine }}
          languageCode: {{ correspondence.Name.FreeFormatNameLine | guess_language(None, 'uk') }}
      fullAddress:
        - text: {{ correspondence.Address.FreeFormatAddressLine }}
          languageCode: {{ correspondence.Address.FreeFormatAddressLine | guess_language(None, 'uk') }}
      countryCode: {{ correspondence.Address.AddressCountryCode }}

  {% endcall %}

{% endcall %}
