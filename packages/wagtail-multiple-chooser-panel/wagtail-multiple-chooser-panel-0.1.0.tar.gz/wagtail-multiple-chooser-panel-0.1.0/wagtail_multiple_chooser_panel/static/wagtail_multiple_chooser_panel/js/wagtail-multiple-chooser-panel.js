(()=>{"use strict";var t={258:(t,e)=>{function i(t){var i=t.closest("[data-panel]"),n=document.querySelector("#".concat(t.getAttribute("aria-controls")));if(n&&i&&!i.collapsibleInitialised){i.collapsibleInitialised=!0;var o=e.MZ.bind(null,t),s=i.classList.contains("collapsed"),a=n.querySelector('[aria-invalid="true"], .error, .w-field--error'),d=s&&!a;d&&o(!1),t.addEventListener("click",o.bind(null,void 0));var l=i.querySelector("[data-panel-heading]");l&&l.addEventListener("click",o.bind(null,void 0)),n.addEventListener("beforematch",o.bind(null,!0)),t.dispatchEvent(new CustomEvent("wagtail:panel-init",{bubbles:!0,cancelable:!1,detail:{expanded:!d}}))}}e.E3=e.MZ=void 0,e.MZ=function(t,e){void 0===e&&(e=!("true"===t.getAttribute("aria-expanded")));var i=document.querySelector("#".concat(t.getAttribute("aria-controls")));i&&(t.setAttribute("aria-expanded","".concat(e)),e?i.removeAttribute("hidden"):"onbeforematch"in document.body?i.setAttribute("hidden","until-found"):i.setAttribute("hidden",""),t.dispatchEvent(new CustomEvent("commentAnchorVisibilityChange",{bubbles:!0})),t.dispatchEvent(new CustomEvent("wagtail:panel-toggle",{bubbles:!0,cancelable:!1,detail:{expanded:e}})))},e.E3=function(t){void 0===t&&(t=document.querySelectorAll("[data-panel-toggle]")),t.forEach(i)}}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=jQuery;var e=i.n(t),n=i(258);class o{constructor(t,i={}){this.opts=i;const n=e()("#"+t+"-ADD");if(this.formContainer=e()("#"+t+"-FORMS"),this.totalFormsInput=e()("#"+t+"-TOTAL_FORMS"),this.formCount=parseInt(this.totalFormsInput.val(),10),i.onInit)for(let t=0;t<this.formCount;t+=1)i.onInit(t);const o=document.getElementById(t+"-EMPTY_FORM_TEMPLATE");o.innerText?this.emptyFormTemplate=o.innerText:o.textContent&&(this.emptyFormTemplate=o.textContent),n.on("click",(()=>{this.addForm()}))}addForm(t={}){const e=this.formCount,i=this.emptyFormTemplate.replace(/__prefix__(.*?['"])/g,e+"$1").replace(/<-(-*)\/script>/g,"<$1/script>");this.formContainer.append(i),this.formCount+=1,this.totalFormsInput.val(this.formCount),"runCallbacks"in t&&!t.runCallbacks||(this.opts.onAdd&&this.opts.onAdd(e),this.opts.onInit&&this.opts.onInit(e))}}class s extends o{constructor(t){super(t.formsetPrefix,t),this.formsElt=e()("#"+t.formsetPrefix+"-FORMS");for(let t=0;t<this.formCount;t+=1){const e=this.opts.emptyChildFormPrefix.replace(/__prefix__/g,t);this.initChildControls(e)}this.updateChildCount(),this.updateMoveButtonDisabledStates(),this.updateAddButtonState()}initChildControls(t){const i="inline_child_"+t,n="id_"+t+"-DELETE",o=e()("#"+i),s=o.find("[data-inline-panel-child-move-up]"),a=o.find("[data-inline-panel-child-move-down]");e()("#"+n+"-button").on("click",(()=>{e()("#"+n).val("1"),o.addClass("deleted").slideUp((()=>{this.updateChildCount(),this.updateMoveButtonDisabledStates(),this.updateAddButtonState()}))})),this.opts.canOrder&&(s.on("click",(()=>{const e=o.find(`input[name="${t}-ORDER"]`),i=e.val(),n=o.prevAll(":not(.deleted)").first();if(!n.length)return;const s=n[0].id.replace("inline_child_",""),a=n.find(`input[name="${s}-ORDER"]`),d=a.val();this.animateSwap(o,n),o.insertBefore(n),e.val(d),a.val(i),this.updateChildCount(),this.updateMoveButtonDisabledStates()})),a.on("click",(()=>{const e=o.find(`input[name="${t}-ORDER"]`),i=e.val(),n=o.nextAll(":not(.deleted)").first();if(!n.length)return;const s=n[0].id.replace("inline_child_",""),a=n.find(`input[name="${s}-ORDER"]`),d=a.val();this.animateSwap(o,n),o.insertAfter(n),e.val(d),a.val(i),this.updateChildCount(),this.updateMoveButtonDisabledStates()}))),"1"===e()("#"+n).val()&&(e()("#"+i).addClass("deleted").hide(0,(()=>{this.updateChildCount(),this.updateMoveButtonDisabledStates(),this.updateAddButtonState()})),e()("#"+i).find(".error-message").remove())}updateMoveButtonDisabledStates(){if(this.opts.canOrder){const t=this.formsElt.children(":not(.deleted)");t.each((function(i){const n=0===i,o=i===t.length-1;e()("[data-inline-panel-child-move-up]",this).prop("disabled",n),e()("[data-inline-panel-child-move-down]",this).prop("disabled",o)}))}}updateChildCount(){this.formsElt.children(":not(.deleted)").each((function(t){e()("[data-inline-panel-child-count]",this).first().text(` ${t+1}`)}))}updateAddButtonState(){if(this.opts.maxForms){const t=e()("> [data-inline-panel-child]",this.formsElt).not(".deleted"),i=e()("#"+this.opts.formsetPrefix+"-ADD");t.length>=this.opts.maxForms?i.prop("disabled",!0):i.prop("disabled",!1)}}animateSwap(t,i){const n=this.formsElt,o=n.children(":not(.deleted)");n.css({position:"relative",height:n.height()}),o.each((function(){e()(this).css("top",e()(this).position().top)})).css({position:"absolute",width:"100%"}),t.animate({top:i.position().top},200,(()=>{n.removeAttr("style"),o.removeAttr("style")})),i.animate({top:t.position().top},200,(()=>{n.removeAttr("style"),o.removeAttr("style")}))}addForm(t={}){super.addForm({runCallbacks:!1});const i=this.formCount-1,o=this.opts.emptyChildFormPrefix.replace(/__prefix__/g,i);this.initChildControls(o),this.opts.canOrder&&e()("#id_"+o+"-ORDER").val(i+1),this.updateChildCount(),this.updateMoveButtonDisabledStates(),this.updateAddButtonState(),(0,n.E3)(document.querySelectorAll(`#inline_child_${o} [data-panel-toggle]`)),"runCallbacks"in t&&!t.runCallbacks||(this.opts.onAdd&&this.opts.onAdd(i),this.opts.onInit&&this.opts.onInit(i))}}window.MultipleChooserPanel=class extends s{constructor(t){super(t),this.chooserWidgetFactory=window.telepath.unpack(JSON.parse(document.getElementById(`${t.formsetPrefix}-CHOOSER_WIDGET`).textContent)),e()(`#${t.formsetPrefix}-OPEN_MODAL`).on("click",(()=>{this.chooserWidgetFactory.openModal((e=>{e.forEach((e=>{this.addForm();const i=this.formCount-1,n=`${t.formsetPrefix}-${i}-${t.chooserFieldName}`;this.chooserWidgetFactory.getById(n).setStateFromModalData(e)}))}),{multiple:!0})}))}}})()})();